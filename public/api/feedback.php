<?php require_once __DIR__ . '/../../includes/functions.php'; require_once __DIR__ . '/../../includes/csrf.php'; require_login(); csrf_check(); $ticket_id=(int)($_POST['ticket_id']??0); $rating=(int)($_POST['rating']??5); $comment=trim($_POST['comment']??''); $s=$pdo->prepare('SELECT user_id FROM tickets WHERE id=?'); $s->execute([$ticket_id]); $owner=$s->fetchColumn(); if($owner != current_user()['id']){ http_response_code(403); die('Forbidden'); } $pdo->prepare('INSERT INTO feedback(ticket_id,user_id,rating,comment,created_at) VALUES(?,?,?,?,NOW())')->execute([$ticket_id,current_user()['id'],$rating,$comment]); header('Location: ../ticket_view.php?id='.$ticket_id);